<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <title>Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 20px; 
            direction: rtl; 
            text-align: right;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
            font-size: 2.2em;
        }
        .search-box { 
            margin-bottom: 30px; 
            text-align: center;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        input[type="text"] { 
            width: 100%;
            max-width: 400px;
            padding: 15px; 
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 25px;
            outline: none;
            transition: border-color 0.3s;
        }
        input[type="text"]:focus {
            border-color: #3498db;
        }
        select {
            padding: 15px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 25px;
            outline: none;
            background: white;
        }
        button { 
            padding: 15px 30px; 
            background: #3498db; 
            color: white; 
            border: none; 
            cursor: pointer;
            font-size: 16px;
            border-radius: 25px;
            transition: background-color 0.3s;
        }
        button:hover {
            background: #2980b9;
        }
        .load-more-btn {
            background: #27ae60;
            margin: 20px auto;
            display: block;
        }
        .load-more-btn:hover {
            background: #219a52;
        }
        .result { 
            border: 1px solid #ddd; 
            margin: 15px 0; 
            padding: 20px; 
            border-radius: 8px;
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .video-link { 
            color: #e74c3c; 
            text-decoration: none; 
            font-weight: bold;
            display: inline-block;
            margin-top: 10px;
            padding: 8px 15px;
            background: #fff5f5;
            border-radius: 5px;
            border: 1px solid #e74c3c;
            transition: all 0.3s;
        }
        .video-link:hover {
            background: #e74c3c;
            color: white;
        }
        .time { 
            color: #7f8c8d; 
            font-size: 14px;
            margin: 10px 0;
        }
        .text-content {
            font-size: 16px;
            line-height: 1.6;
            color: #2c3e50;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-right: 4px solid #3498db;
        }
        .answer-content {
            font-size: 16px;
            line-height: 1.6;
            color: #2c3e50;
            margin: 15px 0;
            padding: 15px;
            background: #f0f7fb;
            border-radius: 5px;
            border-right: 4px solid #27ae60;
        }
        .result-number {
            background: #3498db;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 14px;
            display: inline-block;
            margin-bottom: 10px;
        }
        .results-info {
            text-align: center;
            margin: 20px 0;
            color: #7f8c8d;
            font-size: 16px;
        }
        .no-results {
            text-align: center;
            color: #7f8c8d;
            font-size: 18px;
            margin: 50px 0;
        }
        .loading {
            text-align: center;
            color: #3498db;
            font-size: 18px;
        }
        .question-label, .answer-label {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }
        .question-label {
            color: #3498db;
        }
        .answer-label {
            color: #27ae60;
        }
        
        /* Responsive styles */
        @media (max-width: 768px) {
            body {
                margin: 10px;
            }
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 1.8em;
                margin-bottom: 15px;
            }
            input[type="text"] {
                width: 100%;
                margin-bottom: 10px;
            }
            .search-box {
                flex-direction: column;
                align-items: center;
            }
            button, select {
                width: 100%;
                max-width: 400px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.5em;
            }
            .result {
                padding: 15px;
            }
            .text-content, .answer-content {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©</h1>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù†ØµÙˆØµ... Ù…Ø«Ø§Ù„: ØµÙ„Ø§Ø© Ø§Ù„Ø³ÙØ±">
            <select id="resultLimit">
                <option value="10">10 Ù†ØªØ§Ø¦Ø¬</option>
                <option value="20">20 Ù†ØªÙŠØ¬Ø©</option>
                <option value="50" selected>50 Ù†ØªÙŠØ¬Ø©</option>
                <option value="100">100 Ù†ØªÙŠØ¬Ø©</option>
                <option value="200">200 Ù†ØªÙŠØ¬Ø©</option>
            </select>
            <button onclick="search()">Ø¨Ø­Ø«</button>
        </div>
        <div id="resultsInfo" class="results-info"></div>
        <div id="results"></div>
        <button id="loadMoreBtn" class="load-more-btn" onclick="loadMore()" style="display: none;">
            ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        </button>
    </div>

    <script>
        let isSearching = false;
        let currentQuery = '';
        let currentResults = [];
        let displayedCount = 0;
        let totalResults = 0;
        const LOAD_MORE_INCREMENT = 20;
        
        function search() {
            if (isSearching) return;
            
            const query = document.getElementById('searchInput').value.trim();
            const limit = parseInt(document.getElementById('resultLimit').value);
            
            if (!query) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ù„Ù„Ø¨Ø­Ø«');
                return;
            }
            
            currentQuery = query;
            displayedCount = 0;
            isSearching = true;
            
            const resultsDiv = document.getElementById('results');
            const resultsInfo = document.getElementById('resultsInfo');
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            
            resultsDiv.innerHTML = '<div class="loading">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</div>';
            resultsInfo.innerHTML = '';
            loadMoreBtn.style.display = 'none';
            
            fetch('/search', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({query: query, size: limit})
            })
            .then(response => response.json())
            .then(data => {
                currentResults = data.results || [];
                totalResults = data.total || currentResults.length;
                
                resultsDiv.innerHTML = '';
                resultsInfo.innerHTML = `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${totalResults} Ù†ØªÙŠØ¬Ø©`;
                
                if (currentResults.length > 0) {
                    displayResults(Math.min(LOAD_MORE_INCREMENT, currentResults.length));
                    
                    if (currentResults.length > LOAD_MORE_INCREMENT) {
                        loadMoreBtn.style.display = 'block';
                    }
                } else {
                    resultsDiv.innerHTML = '<div class="no-results">âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø­Ø«</div>';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                resultsDiv.innerHTML = '<div class="no-results">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«</div>';
            })
            .finally(() => {
                isSearching = false;
            });
        }
        
        function displayResults(count) {
            const resultsDiv = document.getElementById('results');
            const startIndex = displayedCount;
            const endIndex = Math.min(startIndex + count, currentResults.length);
            
            for (let i = startIndex; i < endIndex; i++) {
                const result = currentResults[i];
                const div = document.createElement('div');
                div.className = 'result';
                div.innerHTML = `
                    <div class="result-number">Ø§Ù„Ù†ØªÙŠØ¬Ø© ${i + 1}</div>
                    <span class="question-label">Ø§Ù„Ø³Ø¤Ø§Ù„:</span>
                    <div class="text-content">${result.question}</div>
                    <span class="answer-label">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:</span>
                    <div class="answer-content">${result.answer}</div>
                    <div class="time">â° Ø§Ù„ÙˆÙ‚Øª: Ù…Ù† ${result.start} Ø¥Ù„Ù‰ ${result.end} </div>
                    <a href="${result.youtube_link_with_time}" target="_blank" class="video-link">
                        ğŸ¥ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù†Ù‚Ø·Ø©
                    </a>
                `;
                resultsDiv.appendChild(div);
            }
            
            displayedCount = endIndex;
            
            // Hide load more button if all results are displayed
            if (displayedCount >= currentResults.length) {
                document.getElementById('loadMoreBtn').style.display = 'none';
            }
        }
        
        function loadMore() {
            displayResults(LOAD_MORE_INCREMENT);
        }
        
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                search();
            }
        });
        
        // Focus on search input when page loads
        document.getElementById('searchInput').focus();
    </script>
</body>
</html>